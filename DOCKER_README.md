# Развертывание приложения Mentor с использованием Docker

Это руководство поможет вам развернуть приложение Mentor с использованием Docker. Оно включает инструкции по установке, настройке, запуску и управлению контейнерами.

## Содержание

- [Предварительные требования](#предварительные-требования)
- [Архитектура проекта](#архитектура-проекта)
- [Быстрый старт](#быстрый-старт)
- [Детальная настройка](#детальная-настройка)
- [Управление контейнерами](#управление-контейнерами)
- [Резервное копирование](#резервное-копирование)
- [Мониторинг и логи](#мониторинг-и-логи)
- [Безопасность](#безопасность)
- [Устранение проблем](#устранение-проблем)

## Предварительные требования

Для запуска приложения вам потребуются:

- **Docker**: версия 20.10.0 или новее
- **Docker Compose**: версия 2.0.0 или новее
- Минимум 2 ГБ свободной оперативной памяти
- Минимум 5 ГБ свободного дискового пространства

### Установка Docker и Docker Compose

#### Windows
1. Скачайте и установите [Docker Desktop для Windows](https://www.docker.com/products/docker-desktop)
2. После установки перезагрузите компьютер
3. Запустите Docker Desktop

#### macOS
1. Скачайте и установите [Docker Desktop для Mac](https://www.docker.com/products/docker-desktop)
2. После установки перезагрузите компьютер
3. Запустите Docker Desktop

#### Linux (Ubuntu/Debian)
```bash
# Установка Docker
sudo apt-get update
sudo apt-get install docker.io

# Установка Docker Compose
sudo apt-get install docker-compose

# Добавление текущего пользователя в группу docker
sudo usermod -aG docker $USER
# После этой команды выйдите из системы и войдите снова
```

## Архитектура проекта

Приложение Mentor состоит из трех основных компонентов:

1. **Frontend**: React-приложение, работающее под управлением Nginx
2. **Backend**: Go-сервер API
3. **Database**: PostgreSQL для хранения данных

Взаимодействие компонентов:
- Frontend обслуживает статические файлы и проксирует API-запросы на backend
- Backend обрабатывает бизнес-логику и взаимодействует с базой данных
- PostgreSQL хранит все данные приложения

## Быстрый старт

### Windows

```powershell
# Склонируйте репозиторий
git clone https://your-repository-url.git
cd mentor-app

# Запустите скрипт развертывания
.\docker-deploy.ps1
```

### Linux/macOS

```bash
# Склонируйте репозиторий
git clone https://your-repository-url.git
cd mentor-app

# Сделайте скрипт исполняемым
chmod +x docker-deploy.sh

# Запустите скрипт развертывания
./docker-deploy.sh
```

После успешного запуска приложение будет доступно по адресам:
- **Frontend**: http://localhost
- **Backend API**: http://localhost:5000

## Детальная настройка

### Переменные окружения

Основные переменные окружения настраиваются в файле `docker-compose.yml`:

#### Backend
- `DB_HOST`: Хост базы данных (по умолчанию: `postgres`)
- `DB_PORT`: Порт базы данных (по умолчанию: `5432`)
- `DB_USER`: Пользователь базы данных (по умолчанию: `postgres`)
- `DB_PASSWORD`: Пароль базы данных (по умолчанию: `postgres`)
- `DB_NAME`: Имя базы данных (по умолчанию: `mentor`)
- `JWT_SECRET`: Секретный ключ для JWT-токенов (**обязательно измените в production!**)
- `PORT`: Порт для запуска backend (по умолчанию: `5000`)
- `ENVIRONMENT`: Окружение (`development` или `production`)

#### PostgreSQL
- `POSTGRES_USER`: Пользователь PostgreSQL (по умолчанию: `postgres`)
- `POSTGRES_PASSWORD`: Пароль PostgreSQL (по умолчанию: `postgres`)
- `POSTGRES_DB`: Имя базы данных (по умолчанию: `mentor`)

### Изменение портов

Если стандартные порты заняты, вы можете изменить их в `docker-compose.yml`:

```yaml
services:
  frontend:
    ports:
      - "8080:80"  # Изменение с 80 на 8080
  
  backend:
    ports:
      - "8000:5000"  # Изменение с 5000 на 8000
```

### Настройка Nginx

Конфигурация Nginx находится в файле `nginx.conf`. Вы можете изменить ее для настройки заголовков, кеширования, SSL и других параметров.

## Управление контейнерами

### Основные команды

```bash
# Запуск контейнеров в фоновом режиме
docker-compose up -d

# Просмотр запущенных контейнеров
docker-compose ps

# Остановка контейнеров
docker-compose down

# Остановка контейнеров и удаление томов (включая данные)
docker-compose down -v

# Перезапуск одного сервиса
docker-compose restart backend

# Просмотр логов всех сервисов
docker-compose logs -f

# Просмотр логов конкретного сервиса
docker-compose logs -f backend
```

### Обновление приложения

Для обновления приложения выполните:

```bash
# Остановка контейнеров
docker-compose down

# Получение обновлений из репозитория
git pull

# Пересборка и запуск контейнеров
docker-compose build
docker-compose up -d
```

## Резервное копирование

### Резервное копирование базы данных

```bash
# Создание директории для бэкапов
mkdir -p db_backups

# Создание резервной копии
docker-compose exec -T postgres pg_dump -U postgres -d mentor > db_backups/postgres_backup_$(date +%Y%m%d_%H%M%S).sql
```

### Восстановление из резервной копии

```bash
# Восстановление из файла
cat db_backups/your_backup_file.sql | docker-compose exec -T postgres psql -U postgres -d mentor
```

## Мониторинг и логи

### Просмотр логов

```bash
# Просмотр логов всех сервисов
docker-compose logs -f

# Просмотр логов с ограничением строк
docker-compose logs --tail=100 -f
```

### Проверка состояния контейнеров

```bash
# Проверка статуса и здоровья
docker-compose ps

# Детальная информация о контейнере
docker inspect mentor-app_backend_1
```

### Диагностика

Для диагностики проблем выполните:

```bash
# Проверка сети
docker network inspect mentor-network

# Проверка дисков
docker volume ls
```

## Безопасность

### Рекомендации по безопасности

1. **Изменяйте пароли по умолчанию**:
   - Обязательно измените `DB_PASSWORD`, `POSTGRES_PASSWORD` и `JWT_SECRET` в `docker-compose.yml`

2. **Ограничьте доступ к портам**:
   - По возможности, не выставляйте порт PostgreSQL (5432) наружу

3. **SSL-шифрование**:
   - Для production настройте SSL-сертификаты в Nginx

4. **Регулярные обновления**:
   - Периодически обновляйте образы Docker до последних версий

## Устранение проблем

### Проблемы с подключением к базе данных

**Проблема**: Backend не может подключиться к PostgreSQL.

**Решение**:
1. Проверьте статус контейнера PostgreSQL: `docker-compose ps postgres`
2. Проверьте логи: `docker-compose logs postgres`
3. Убедитесь, что переменные окружения для подключения к БД настроены правильно

### Проблемы с доступом к приложению

**Проблема**: Приложение недоступно по указанному адресу.

**Решение**:
1. Проверьте, что все контейнеры запущены: `docker-compose ps`
2. Проверьте логи: `docker-compose logs`
3. Проверьте, что порты не заняты другими приложениями
4. Проверьте настройки брандмауэра

### Проблемы с производительностью

**Проблема**: Приложение работает медленно.

**Решение**:
1. Проверьте загрузку ресурсов: `docker stats`
2. Увеличьте лимиты памяти и CPU в `docker-compose.yml` при необходимости
3. Оптимизируйте запросы к базе данных

---

## Поддержка

Если у вас возникли вопросы или проблемы при развертывании, обратитесь к документации или создайте issue в репозитории проекта. 